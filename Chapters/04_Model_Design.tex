
A more sophisticated controllers is needed for our upper extremity FES system, because unlike the cyclic movemenf ot the lower, upper-extremity tasks are goal directed. This means that the amplitude, speed adn direction of the motions change continuously, so the controller need to continuously calculate the stimulation patterns for a wide range of motions commanded by the user. \cite{CFF}. 
% General Idea
Veltnik and Chizeck et al. described the muscle output torque relation to the input stimulation and joint angle using a muscle model that include the muscle activation. They designed a nonlinear open-loop compensator and controlled the joint angle using a PID feedback controller. \cite{NNPID}

%% Model Problems
% 
Model-based FES control is key in providing the required accuracy, but few approaches have transferred into clinical practice. This is due to the difficulties in obtaining an accurante model since the identification time available is restricted by the onset of fatigue and time constraints of the patient, carer, physiotherapist or enginerer. \cite{IOL}.
Time-varying physiological effects also mean that the models must be reidentified at the start of each treatment session. 
% Parametrization problems 
It is difficult to establish the control parameters for these systems and new parameters must be reestablished for each subject. The parameters are not always the same even for the same subject under different circumstances. The traditional control theory, which first requests a mathematicam model for the controlled system, is not applicable. \cite{NNPID}.

%% Control Method
% Feedforward
There are different control strategies used in existing FES systems. Feedforward control is commonly used in clinical practice (13,15). The output of this type of controller depends only on the user command, and not on the system performance. The advantage of this design is that it does need sesnros to measure the system output, but the disadvante is that it is unable to make corrections it he actual movmeent deviates from the desired movement. \cite{CFF}

% Feedback
Feedback control usess sensors to monitor output, so it can correct for errors in the system trajectory. Feedback is necessary in order to maintain good tracking performance in the rpesence of fatigue and any external distrubances encountered. However, inherent delays in the response of the system can cause problem to the feedback controller, especially in the case of fast movements. \cite{CFF}

Therefore a combination of feedforward and feedback control has the best results, and is the preferred control method in several FES system designs. 

The feedfoward is typically an inverse-dynamic model of the controlled system. Train an ANN to behave like the inverse-dynamic model. An ANN that includes time-delayed inputs can approximate any dynamic systems based solely on the knowledge of inputs and ouputs.

% Neural Network Control
Develop a non-modeling control controlling method. The neural network control theory is just one method to this approach.\cite{NNPID}.

Controller system. The 3-level network structure uses back-propagation. The NN was used to evaluate the stimulation current. The PID controller part was used to fine-tune the current. Supervised learning neural network. The network was designed to find the input/output coincidence relations with minimum error using a back propagation algorithm. The network controllers is trained by the NN before patient applications are begun. Only after training, the network controller can be applied to the control system. \cite{NNPID}

The designed electrical stimulating current signals are used to stimulate the patientÂ´s foot. The changing ankle joint angle value is measured. It is given as an input to the neural network. A relation between the stimulating current and the the ankle joint angle is established. The supervised learning method and back-propagation algorithm were used to inversely implement the learning modifications. Backward error propagation \cite{NNPID}.

% Iterative Learning Control
Iterative Learning Control (ILC) is another leading appraoch, and has exploited the repetitive nature of the rehabilitation process, where patients attempt the same task multiple times to promote relearning. ILC sequentially improves accuracy using fata from previous attempts to adjust the FES supplied during the next execution of the tasks, and has been succesfully used by several groups to assist movement in the lower limb (additional references) \cite{IOL}.

The ILC structura has minimial parameters that can be tuned to compromise performance and robustness in an intuitive manner, including stipulation of convergence and trial-to-trial control effort. When combined with input-output linearization these properties can be set for each joint independently, and hence generalize to arbitrary DOF. \cite{IOL}

ILC is applicable to systems which repeatedly track a fixed reference signal over a finite time interval, termed a trial. 
After each trial, the system is reset to the same initial condidition, and previous trial data are used to modify the control input ot reduce the error in the subsequent trial. ILC is often applied in combination with a feedback controller to ensure disturbance rejection and baseline tracking perforamnce. All ILC systems are subject o iteration varying disturbance and modeling uncertainty. The effects of model uncerstainty results in the input-output linearization action producing a system that does not equate to G(s). 

% FES deviced used
Functional Electrical Stimulator (a DSP-based FES) was developed in our laboratory. 23,35,50Hz are available ofr the pulse frequency. 
The pulse width ranges from 0 to 300 $\mu$s. The output current is from 0 to 100 mA. The stimulation wave can be modified into two models: single phase, and biphasic phase. \cite{NNPID}



% Problems
Referring to the past literature, no one has been able to solve the transfer functions for mucles and bone systems. We obtained better values in this experiment with continuous testing. The stability results were greatly influenced if the Kp, Ki and Kd parameters in the PID controller were adjusted. \cite{NNPID}

% Muscle Selection and Modelling
Spasticity (velocity-dependent stiffness) in stroke typically produces resistance to arm extension due to overactivity of biceps, wrists and finger flexors and loss of activity of triceps, anterior deltoid, wrist and finger extensors (reference 24). \cite{IOL}
Triceps and anterior deltoid are hence selected for stimulation to align with the clinical need to increase muscle tone and restore motor control of weakened muscles. 
The relationship between muscle stimulation adn subsequent movement are well explored. However, simplification opens up routes for both aprameter identification and controller derivation that have not yet been possible for more complex models. \cite{IOL}
It is assumed that applying FES to the anterior deltoid produces a moment about an axis that is fixed with respect to the shoulder. Applying FES to the triceps produces a moment about an axis orthogonal to both the forearm and upper arm.\cite{IOL}

As discussed in [26] the most prevalent form of muscle representation is the Hill-type muscle. (Explain the Hill-Type muscle)